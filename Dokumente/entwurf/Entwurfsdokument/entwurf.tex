\documentclass[parskip=full,11pt]{scrartcl}
\usepackage[utf8]{inputenc}

%\title{Simulator für wiederholte Spiele}
%\author{Sebastian Feurer, Peter Koepernik, Luc Mercatoris,\\Christian Schorr, Pierre Toussing}

% section numbers in margins:
\renewcommand\sectionlinesformat[4]{\makebox[0pt][r]{#3}#4}

% header & footer
\usepackage{scrlayer-scrpage}
\lofoot{\today}
\refoot{\today}
\pagestyle{scrheadings}

\usepackage[sfdefault,light]{roboto}
\usepackage[T1]{fontenc}
\usepackage[german]{babel}
\usepackage[yyyymmdd]{datetime} % must be after babel
\renewcommand{\dateseparator}{-} % ISO8601 date format
\usepackage{hyperref}
\usepackage{bbm}
\usepackage{amsmath} % for $\text{}$
\usepackage{amssymb}
\usepackage[nameinlink]{cleveref}
\crefname{figure}{Abb}{Abb}
\usepackage[section]{placeins}
\usepackage{xcolor}
\usepackage{graphicx}
\usepackage{subfig}
\usepackage{float} % für Fließumgebungen; Platzierung H verschiebt nicht
\usepackage{multirow}
\restylefloat{figure}
\hypersetup{
	pdftitle={Pflichtenheft},
	bookmarks=true,
}
\usepackage{csquotes}

\newcommand\urlpart[2]{$\underbrace{\text{\texttt{#1}}}_{\text{#2}}$}

\usepackage{pflichtenheft}

\usepackage[nonumberlist]{glossaries}

\usepackage[T1]{fontenc}
\usepackage[scaled=0.85]{beramono}

\begin{document}
\section{Einleitung}
TODO

\section{Pakete und Klassen}
\subsection{Paket \texttt{edu.kit.loop.model}}
Das Modell beinhaltet Klassen und Methoden zum Starten und Abbrechen von Simulationen, sowie zum Erstellen und Speichern von Konfigurationen, Stufenspielen, Strategien und Populationen.

\subsubsection{Class \texttt{UserConfiguration}}
//vielleicht im falschen Package

Diese Klasse repräsentiert eine vom Nutzer erstellte Konfiguration. Sie bietet Methoden zum Lesen aller zugehörigen Parameter.

Konstruktoren:

Methoden:

\subsubsection{Class \texttt{Configuration}}
Diese Klasse repräsentiert die elementare Konfiguration einer einzelnen Wiederholung und enthält alle Informationen zum Start einer solchen:
\begin{itemize}\itemsep -10pt
\item Stufenspiel
\item Anzahl von Agenten
\item Runden pro Wiederholung
\item Ob gemischte Strategien zugelassen sind
\item Gruppen-/Segmenteinteilungen
\item Kapital- und Strategieinitialisierung der Segmente
\item Agentenpaarung
\item Erfolgsquantifizierung
\item Adaptionsmechanismus
\item Gleichgewichtskriterium
\item Maximale Zahl von Adaptionsschritten
\end{itemize}

Konstruktoren:

Methoden:

\subsection{Paket \texttt{edu.kit.loop.model.simulator}}
Dieses Paket enthält das Interface \texttt{Simulator}. Dieses bietet eine Schnittstelle zum Starten und Abbrechen von Simulationen. Beim Start einer Simulation wird eine Referenz auf ein \texttt{Simulation}-Objekt zurückgegeben, über das der Ausführungsstatus und die Ergebnisse der Simulation abgefragt werden können.

\subsubsection{Class \texttt{Simulation}}
Ein \texttt{Simulation}-Objekt enthält Informationen zu einer gestarteten Simulation, etwa deren Konfiguration, Ausführungsstatus, \texttt{id} und gegebenenfalls die Ergebnisse der Simulation. Es wird von einem \texttt{Simulator} erzeugt und bereitgestellt, wenn eine Simulation gestartet wird.

Die Klasse unterscheidet nicht zwischen Multikonfigurationen und Nicht-Multikonfigurationen, geht also allgemein von mehreren zugrundeliegenden elementaren Konfigurationen aus.

Konstruktoren:
\begin{itemize} \itemsep -10pt
\item \texttt{Simulation(UserConfiguration config, int id)}
\item[] Erzeugt ein neues \texttt{Simulation}-Objekt mit der gegebenen \texttt{UserConfiguration} und der gegebenen \texttt{id}.
\item[] \texttt{config}: die Konfiguration der Simulation
\item[] \texttt{id}: die \texttt{id} dieser Simulation
\end{itemize}

Methoden:
\begin{itemize}\itemsep -10pt
\item \texttt{protected void addIterationResult(IterationResult result, int i)}
\item[] Fügt ein Wiederholungsergebnis zur \texttt{i}-ten elementaren Konfiguration dieser Simulation als \texttt{IterationResult} hinzu.
\item[] \texttt{result}: das Wiederholungsergebnis, das hinzugefügt werden soll
\item[] \texttt{i}: die elementare Konfiguration, zu der das Wiederholungsergebnis hinzugefügt werden soll

\item \texttt{void registerIterationFinished(Consumer<IterationResult> action)}
\item[] Registriert eine Aktion, die jedes mal ausgeführt wird, wenn eine Wiederholung dieser Simulation abgeschlossen wird. Der Aktion wird als Argument das Ergebnis der Wiederholung als \texttt{IterationResult} übergeben.
\item[] \texttt{action}: Die Aktion, die bei Abschluss jeder Wiederholung dieser Simulation ausgeführt werden soll

\item \texttt{List<IterationResult> getIterationResults(int i)}
\item[] Gibt eine Liste der Wiederholungsergebnisse der bisher abgeschlossenen Wiederholungen mit der \texttt{i}-ten zugrundeliegenden elementaren Konfiguration als \texttt{IterationResult}s zurück.
\item[] \texttt{i}: die elementare Konfiguration, zu der die Wiederholungsergebnisse zurückgegeben werden sollen
\item[] Returns: die Wiederholungsergebnisse der bisher abgeschlossenen Wiederholungen mit der \texttt{i}-ten zugrundeliegenden elementaren Konfiguration

\item \texttt{UserConfiguration getUserConfiguration()}
\item[] Gibt die \texttt{UserConfiguration} dieser Simulation zurück.
\item[] Returns: die \texttt{UserConfiguration} dieser Simulation

\item \texttt{int getConfigurationCount()}
\item[] Gibt die Zahl der dieser Simulation zugrundeliegenden elementaren Konfigurationen zurück. Im Falle einer Multikonfiguration also die Anzahl verschiedener Werte des Multikonfigurationsparameters, ansonsten \(1\).
\item[] Returns: die Zahl der dieser Simulation zugrundeliegenden elementaren Konfigurationen

\item \texttt{int getId()}
\item[] Gibt die \texttt{id} dieser Simulation zurück.
\item[] Returns: die \texttt{id} dieser Simulation
\end{itemize}

\subsubsection{Interface \texttt{Simulator}}
Über einen Simulator können Simulationen gestartet und abgebrochen werden. Zum Starten einer Simulation muss dem \texttt{Simulator} eine \texttt{UserConfiguration} übergeben werden, die die durchzuführende Simulation spezifiziert. Daraufhin wird ein \texttt{Simulation}-Objekt erzeugt und zurückgegeben, über das der Ausführungsstatus und die Ergebnisse der gestarteten Simulation abgefragt werden können. Jeder Simulation wird beim Start eine eindeutige \texttt{id} zugewiesen.

Methoden:
\begin{itemize} \itemsep -10pt
\item \texttt{Simulation startSimulation(UserConfiguration config)}
\item[] Startet eine Simulation mit der gegebenen \texttt{UserConfiguration} und gibt ein \texttt{Simulation}-Objekt zu der gestarteten Simulation zurück.
\item[]\texttt{config}: die Konfiguration, mit der die Simulation ausgeführt werden soll
\item[] Returns: ein \texttt{Simulation}-Objekt zu der gestarteten Simulation

\item \texttt{Simulation startSimulation(UserConfiguration config, Consumer<Simulation> action)}
\item[] Startet eine Simulation mit der gegebenen Konfiguration und gibt ein \texttt{Simulation}-Objekt zu der gestarteten Simulation zurück. Führt die gegebene Aktion mit der zurückgegebenen \texttt{Simulation} als Argument aus, sobald die Ausführung der Simulation abgeschlossen ist.
\item[] \texttt{config}: die Konfiguration, mit der die Simulation ausgeführt werden soll
\item[] \texttt{action}: Die Aktion, die ausgeführt werden soll, sobald die Simulation abgeschlossen ist
\item[] Returns: ein \texttt{Simulation}-Objekt zu der gestarteten Simulation

\item \texttt{boolean stopSimulation(Simulation sim)}
\item[] Falls die gegebene Simulation aktuell läuft, wird diese abgebrochen und \texttt{true} zurückgegeben. Andernfalls wird \texttt{false} zurückgegeben.
\item[] \texttt{sim}: Die Simulation, die abgebrochen werden soll
\item[] Returns: \texttt{true}, wenn die Simulation erfolgreich abgebrochen wurde, \texttt{false} sonst

\item \texttt{boolean stopSimulation(int id)}
\item[] Falls eine Simulation mit der gegebenen \texttt{id} läuft, wird diese abgebrochen und \texttt{true} zurückgegeben. Andernfalls wird \texttt{false} zurückgegeben.
\item[] \texttt{id}: Die \texttt{id} der Simulation, die abgebrochen werden soll
\item[] Returns: \texttt{true}, wenn die Simulation erfolgreich abgebrochen wurde, \texttt{false} sonst

\item \texttt{void stopAllSimulation()}
\item[] Bricht die Ausführung aller gestarteten Simulationen ab.

\item \texttt{Simulation getSimulation(int id)}
\item[] Gibt das \texttt{Simulation}-Objekt der Simulation mit der entsprechenden \texttt{id} zurück, falls existent. Ansonsten \texttt{null}.
\item[] \texttt{id}: Die \texttt{id} der Simulation, deren \texttt{Simulation}-Objekt zurückgegeben werden soll
\item[] Returns: das \texttt{Simulation}-Objekt der Simulation mit der entsprechenden \texttt{id}, falls existent. Ansonsten \texttt{null}.
\end{itemize}

\subsubsection{Class \texttt{ThreadPoolSimulator}}
Implements: \texttt{Simulator}

Eine Implementierung des \texttt{Simulator}-Interfaces. Führt die Wiederholungen parallel in einem \texttt{ThreadPool} aus.

Konstruktoren:
\begin{itemize}\itemsep -10pt
\item \texttt{ThreadPoolSimulator()}
\item[] Erzeugt einen neuen \texttt{ThreadPoolSimulator}.

\item \texttt{ThreadPoolSimulator(int maxThreads)}
\item[] Erzeugt einen neuen \texttt{ThreadPoolSimulator} mit der gegebenen maximalen Anzahl von \texttt{Thread}s.
\item[] \texttt{maxThreads}: die maximale Anzahl von \texttt{Thread}s im \texttt{ThreadPool}
\end{itemize}

Methoden:
\begin{itemize}\itemsep -10pt
\item \texttt{int getRunningIterationCount()}
\item[] Gibt die Zahl aktuell ausgeführter Wiederholungen zurück.
\item[] Returns: die Zahl aktuell ausgeführter Wiederholungen

\item \texttt{int getQueuedIterationCount()}
\item[] Gibt die Zahl aktuell auf Ausführung wartender Wiederholungen zurück.
\item[] Returns: die Zahl aktuell auf Ausführung wartender Wiederholungen
\end{itemize}

\subsubsection{Class \texttt{ConfigurationCreator}}
Diese Klasse nimmt eine \texttt{UserConfiguration} entgegen und extrahiert daraus alle zugehörigen elementaren Konfigurationen. Diese werden als \texttt{Configuration}s zurückgegeben.

Konstruktoren:
\begin{itemize}\itemsep -10pt
\item \texttt{ConfigurationCreator()}
\item[] Erzeugt einen neuen \texttt{ConfigurationCreator}.
\end{itemize}

Methoden:
\begin{itemize}\itemsep -10pt
\item \texttt{List<Configuration> generateConfigurations(UserConfiguration config)}
\item[] Erzeugt alle zu der gegebenen \texttt{UserConfiguration} gehörigen elementaren Konfigurationen und gibt sie als \texttt{Configuration}s zurück.
\item[] \texttt{config}: Die \texttt{UserConfiguration}, zu der alle elementaren Konfigurationen generiert werden sollen
\item[] Returns: alle zu der gegebenen \texttt{UserConfiguration} gehörigen elementaren Konfigurationen als \texttt{Configuration}s
\end{itemize}

\subsection{Paket \texttt{edu.kit.loop.model.simulationengine}}

\subsubsection{Class \texttt{GameResult}}

Diese Klasse speichert das Ergebnis einer Runde zwischen zwei Agenten. Das Ergebnis besteht aus:
\begin{itemize}\itemsep -10pt
	\item Den beteiligten Agenten
	\item Den Aktionen der beteiligten Agenten
	\item Die erhaltenen Auszahlungen der Agenten
\end{itemize}
	
Konstruktor:

Methoden:
\begin{itemize}\itemsep -10pt
	\item \texttt{Agent getMainAgent()}
	\item[]Gibt den Hauptspieler der zum Ergebnis gehörenden Runde zurück.
	\item[]Returns: Der Hauptagent der Runde
	\item \texttt{Agent getOpponentAgent()}
	\item[]Gibt den Gegenspieler der zum Ergebnis gehörenden Runde zurück.
	\item[]Returns: Der Gegenspieler der Runde
	\item \texttt{int getMainAgentPayoff()}
	\item[] Gibt die in der zughörigen Runde erzielte Auszahlung des Hauptspielers zurück.
	\item[]Returns: Die erzielte Auszahlung
	\item \texttt{int getOpponentAgentPayoff()}
	\item[] Gibt die in der zughörigen Runde erzielte Auszahlung des Gegenspielers zurück.
	\item[]Returns: Die erzielte Auszahlung
	\item \texttt{boolean hasMainAgentCooperated()}
	\item[]Gibt zurück, ob der Hauptspieler in der zugehörigen Runde kooperiert hat oder nicht.
	\item[]Returns: 
	\item \texttt{boolean hasOpponentAgentCooperated()}
	\item[]Gibt zurück, ob der Gegenspieler in der zugehörigen Runde kooperiert hat oder nicht.
	\item[]Returns: 
\end{itemize}


\subsubsection{Interface \texttt{SimulationHistory}}
Eine Implementierung des \texttt{SimulationHistory}-Interfaces speichert für jeden Agenten die Ergebnisse aller bisherigen Runden eines Adaptionsschrittes. Es werden Methoden zum Hinzufügen ne bereitgestellt:

Methoden:
\begin{itemize}\itemsep -10pt
	\item \texttt{void addResult(GameResult result)}
	\item[] Fügt der Historie ein neues Rundenergebnis hinzu.
	\item[] \texttt{result}: Das \texttt{GameResult}, das zur Historie hinzugefügt werden soll
	\item \texttt{List<GameResult> getAllResults()}
	\item[]Gibt alle Rundenergebnisse  aller Agenten als Liste zurück.
	\item[]Returns: Die Liste der Rundenergebnisse
	\item \texttt{List<GameResult> getResultsByAgent(agent: Agent)}
	\item[]Gibt alle Rundenergebnisse des gegebenen Agenten als Liste zurück.
	\item[] \texttt{agent}: Der Agent dessen Ergebnisse abgefragt werden
	\item[]Returns: Die Liste der Rundenergebnisse
	\item \texttt{List<GameResult> getLatestResults()}
	\item[]Gibt das letzte Rundenergebnis aller Agenten als Liste zurück.
	\item[]Returns: Die Liste der Rundenergebnisse
	\item \texttt{GameResult getLatestResultByAgent(agent: Agent)}
	\item[] Gibt das letzte Rundenergebnis des gegebenen Agenten zurück.
	\item[] \texttt{agent}: Der Agent dessen letztes Ergebnis abgefragt wird
	\item[]Returns: Das letzte RundenErgebnis des Agenten als \texttt{GameResult}
	\item \texttt{Iterable<GameResult> getAllWhere(condition: Predicate<GameResult>)}
	\item[] Filtert alle Rundenergebnisse gemäß einer gegebenen Filterbedingung und liefert sie in Form eines \texttt{Iterable} zurück.
	\item[]\texttt{condition}: Die Filterbedinung als Prädikat mit einem \texttt{GameResult} als Parameter.
	\item[]Returns: Die gefilterten Rundenergebnisse als \texttt{Iterable}
	\item \texttt{GameResult getLatestWhere(condition: Predicate<GameResult>)}
	\item[] Filtert alle Rundenergebnisse gemäß einer gegebenen Filterbedingung und liefert das letzte Rundenergebnis, welches die Bedingung erfüllt zurück.
	\item[]\texttt{condition}: Die Filterbedinung als Prädikat mit einem \texttt{GameResult} als Parameter.
	\item[]Returns: Das letzte Rundenergebnis, welches die Filterbedingung erfüllt
\end{itemize}

\subsubsection{Class \texttt{SimulationHistoryTable}}
Implements: \texttt{SimulationHistory}

Diese Klasse implementiert das \texttt{SimulationHistory}-Interface.


\section{Glossar}
\textbf{Elementare Konfiguration:}
Eine Konfiguration, in der Multikonfiguration deaktiviert ist. Mit den \enquote{einer Konfiguration zugehörigen elementaren Konfigurationen} wird im Falle einer Multikonfiguration die Menge aller elementaren Konfigurationen bezeichnet, in denen der Multikonfigurationsparameter die festgelegte Wertemenge durchläuft. Im Falle einer elementare Konfiguration ist wieder die Konfiguration selbst gemeint.

\end{document}
